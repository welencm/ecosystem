---
- name: "install common packages"
  package:
    name: "{{ item }}"
    state: present
    update_cache: yes
  with_items:
    - vim
    - git
    - zip
    - unzip
    - tar
    - wget
    - htop
    - tmux
    - ncdu
    - htop
  become: true
  tags:
    - packages

- include: common-apt.yml
  when: ansible_pkg_mgr == 'apt'

- include: common-yum.yml
  when: ansible_pkg_mgr == 'yum'

- name: "user setup"
  user:
    name: "{{ ansible_user }}"
    generate_ssh_key: yes
    ssh_key_bits: 2048
    password: '$6$ci45Bc.7Fc181jeL$ub7930PGzGPp2kqUZ8c8gMonI/0j9xfrEqsNxqZ./z8E9GnEcTqn1tc63gas.w9zHgdtB.fDRglqHF1KpZB87/'
  become: true
  tags:
    - password
    - user

- name: "provide .bashrc"
  copy:
    src: ".bashrc"
    dest: "{{ ansible_user_dir }}"
    mode: 0660
  tags:
    - user

- name: "provide .vimrc"
  copy:
    src: ".vimrc"
    dest: "{{ ansible_user_dir }}"
    mode: 0660
  tags:
    - user

- name: "make sure .ssh directory exists"
  file:
    path: "{{ ansible_user_dir}}/.ssh"
    state: directory
  tags:
    - user
    - ssh

- name: "make sure .ssh/config exists"
  file:
    path: "{{ ansible_user_dir}}/.ssh/config"
    state: touch
  tags:
    - user
    - ssh

- name: "provide ssh config"
  blockinfile:
    block: "{{ lookup('file', 'ssh.config') }}"
    dest: "{{ ansible_user_dir}}/.ssh/config"
    backup: yes
  become: true
  tags:
    - user
    - ssh

- name: "update /etc/hosts file"
  blockinfile:
    block: "{{ lookup('file', 'hosts') }}"
    dest: "/etc/hosts"
    backup: yes
  become: true
  tags:
    - hosts

- name: "set timezone"
  timezone:
    name: "CET"
  become: true
  tags:
    - time
